<script>
    const setProperties = (header, text, code, minSize, maxSize, lheight) => {
        const styles = getComputedStyle(document.documentElement);
        const dh = styles.getPropertyValue("--default-font-family-headers")
        const dc = styles.getPropertyValue("--default-font-family-code")
        const dt = styles.getPropertyValue("--default-font-family-text")
        const dmin = styles.getPropertyValue("--default-min-font-size")
        const dmax = styles.getPropertyValue("--default-max-font-size")
        const lh = styles.getPropertyValue("--default-line-height")

        document.documentElement.style.setProperty("--font-family-headers", `${header || text || dh}, ${dh}`)
        document.documentElement.style.setProperty("--font-family-text", `${text || header || dt}, ${dt}`)
        document.documentElement.style.setProperty("--font-family-code", `${code}, ${dc || text || dc}`)
        document.documentElement.style.setProperty("--min-font-size", minSize || dmin)
        document.documentElement.style.setProperty("--max-font-size", maxSize || dmax)
        document.documentElement.style.setProperty("--line-height", lheight || lh)
    }

    const setStyle = (el) => {
        const link = el.dataset.link
        const header = el.dataset.header
        const text = el.dataset.text
        const code = el.dataset.code
        const minSize = el.dataset.minsize
        const maxSize = el.dataset.maxsize
        const lheight = el.dataset.lineheight

        if(link && link != '///') {
            var fileref = document.createElement("link")
            fileref.setAttribute("rel", "stylesheet")
            fileref.setAttribute("type", "text/css")
            fileref.setAttribute("href", link)        
            document.getElementsByTagName("head")[0].appendChild(fileref)
            fileref.addEventListener("load", e => {
                setProperties(header, text, code, minSize, maxSize, lheight)
            })
        } else {
                setProperties(header, text, code, minSize, maxSize, lheight)
        }
        localStorage.setItem("Style", el.textContent)
    }

    const defaultFont = "Contemporary: Georgia"

    const style = localStorage.getItem("Style") || defaultFont

    if(style && style !== defaultFont) {
        const xpath = "//div[text()='" + style + "']"
        const styleEl = document
            .evaluate(xpath, document, null, XPathResult.ANY_TYPE, null)
            .iterateNext()
        if(styleEl)
            setStyle(styleEl);
        else
            localStorage.removeItem("Style")
    }

    const fontEl = document.querySelector(".dropdown-content")
    fontEl.addEventListener("click", e => {
        const el = e.target
        setStyle(el)
    })

    const randElem = document.querySelector("#random-font")
    randElem.addEventListener("click", e => {
        const parent = document.querySelector(".dropdown-content")
        const children = parent.childNodes
        const array = Array.from(children)
        const randomEl = array[Math.floor(Math.random() * array.length)]
        setStyle(randomEl)
    })
    const which = document.querySelector("#which-font")
    which.addEventListener("mouseenter", e => {
        const styles = getComputedStyle(document.documentElement);
        const which = document.querySelector("#which-font")
        which.innerHTML = "[" + styles.getPropertyValue("--font-family-text").split(",")[0] + "]"
    })
    which.addEventListener("mouseleave", e => {
        const which = document.querySelector("#which-font")
        which.innerHTML = "[Which]"
    })
</script>